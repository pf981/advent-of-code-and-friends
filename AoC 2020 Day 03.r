# Databricks notebook source
library(tidyverse)

# COMMAND ----------

input <- ".#..#....##...#....#.....#.#...
........##....#..#..##....#.#..
......##......##.........#....#
...#.....#....##.......#.#....#
.#.###.#.#..#.....##..#....#.#.
##.........##.....####......#..
#...#..........#.##............
####............#..........#.#.
......#......#....##...#..##...
#..#....#...#......#......####.
......#..........#.........#.#.
...##.......#..#.#..#..#....#..
..####....#.#...............##.
...###........#.....#..........
#..#.##...##.#..##...##...#....
.###........#.##..#.#.....#....
.#.......#..##.......#......#..
.##...........#..............#.
...#..#.....#...........#...#..
.....#..............#..#.......
.......#....#.....##...........
.#...#.............#.....##....
....#.#....#...#...#..#..##.#..
...#..##..##...#..##........#.#
.###..#...#.#.#.#..#...#.......
.....##.#.##.#.#.......#..#....
.##.#...#.....#...#....#.....#.
.....#......###....###..##.#..#
.....#..##....#..#.#..#.#.#....
#....#.....#.#.......#...#....#
...#........#............#..#..
#.#...#...#..##.........#...##.
.#..#.#...........#....#...#...
##..#.#..........#.....###...#.
#..#........#.......#.#..#....#
..#...##....#..#....#....#.....
...#.....##....#...#..#....##.#
.....#......#...#.#.#.#.#......
###.....#..#.#..........##.#...
...............#..#...#.#....#.
#.....#.....###....#..........#
........#...#.#.......#..#...#.
..#.##...#...#...#.........#...
#..........#..#.#...........##.
##.......#.#.#...#.....#.......
...#.#.#.....#......#....##..#.
##.#.....#....#...#.......#....
.#......##..#.##.#....##..##.#.
..#..#......#....#...#..#.#....
...#..###...#.......#..#.......
...#....#..#....#........##....
#...#...#....#.#.........###.#.
.#.........##..##...#..........
...##.....##.........#..#..#...
###....#......#.##..#...#......
.###....#.#.......#..#....#...#
....####........##....#.#....##
..#.....#......##...#..#..#....
...#....#...#......#.###.#.#.#.
......#.......#..#...#...#.....
.#...#...#..#.#..........#.....
........#..#.........#.#....##.
.#....#.......#........#.##.#..
...#...#..#.....#......#...##..
.#.................#........###
.......#.#..#.#...#............
.#.......#..##...#.###....#.##.
#........#.###.#..#........##..
..##.#....##......##........#..
...............#...............
#.......#......##..#.#....#.#.#
..#.....#......#.#.#...#...##..
..........#........#.....##...#
#..........#.#..#..##..#......#
.......#..###..##.#..##........
#.#..##..###..#.###.....#.#..##
..#.#........#...###...##......
.......##.....##...#.##........
.#.#...###..#..#......##....##.
#...#.#.....##..#..#..#.#....#.
........#......#....#..#.......
...#.#.#.#........###....#...#.
.#......#...#.......#......#...
#...#.##.#..#.#..#.........#...
....#......##......#........#.#
..##.#.....#..#......#..#......
#.##...##...#................#.
.....#..#....#....#####........
....#..#..#.#...#.#............
.........#.#....#..#....##...#.
#....#..........#......#......#
.......#..............#......#.
.#..#...#..#.#.....#.#.#.##.#..
.##........#......#...#.##.....
...#.##..#........#...........#
..#...#..#........#.......#.#..
#.....#..#.#..#..#...#...#..#..
..................#.#.....#...#
........#...##.#..#.........#..
.#...##.#...........##.##...#..
#......#.........#...#...#...#.
..........#.............#...#..
#............##.#..#...#.#...#.
..#.##...##....##.#...####...#.
#.##..#......#.......#.#...##..
.....#...#..#......#####.##..#.
#...#.#.##..#..##.....#......#.
.#..#......#.#.#...#.#...##.#..
.#.....#..##........#.....#...#
.................#..........#..
##.#.#......#.####..#.....#....
.#...##.####..#...#............
..#...............###....#....#
#...#..###..#.#.##...........##
...................#..#.....#..
...#.##.#...#.....#......#.##..
#.#...#.........##.#........#.#
.##.......#..#..#.....##....#..
......##.#.#..#...#.#..##.....#
..#..###...#...#......#.#......
..##....#.#...#....#....#..#..#
#..##....#........#..##..#..#.#
.......#............#....##..#.
.#.#..#.........#.#.##......#..
#.#....#..##..#..###.#.....##..
.###.#......#.....#####...#....
#...#.#...##......#...#.#...##.
#..#.........#..#............#.
...##......##.......##....##...
...#...##....###..###.#...#....
#.#....#...#.#...##..#........#
.#..#..................#....#..
#......#..#...##..##...#..##..#
...#..#.....#...#........#.#.#.
#...#..##....#.....#........#..
.##..#....#.....#.#............
##..##.#.#.##.#.#..#.#..#....#.
#.......#...............#.....#
..#.....#..##.....#...##.##....
...#..#...#.#.#....#......#....
###.#.......#....#....#.#...#..
.....###..#...###.#.#..#.......
.....#.........##.#....#..##.#.
........#....#....#....#.#..##.
........###....#.#.........#.#.
.#..###..#........#.......##.#.
.#.#...........................
..#....##...#.#....#....#.#....
.#...#...##.#........###....#..
#.#....#...#.#.#...##......##..
#......#....#...#..#....#...#..
...#..##........#.#...##......#
....##...........##...#..#..#..
......#..#........#..#....##.##
.###..#.#.........#.....#......
.#..##............#......#.....
..##.#.#..#..#.###....#..#..#..
....#.#..#.#..##...##.#.#.#.#..
....#..#....#...............#..
..#...#.##.....##....#..##..#..
.......##.#....#.##....#.......
.#...#........#...#......#.###.
..#....##.......#....#.#...#.#.
.....#.....#...##..#....#.#..##
..##........##............##...
..........#...#.......#.......#
.#...............#...#.##......
#.##......#....#.##.#..#..#...#
......###.........#...#..#....#
....#......#...#....#....#...#.
#...##...#....#......####....#.
.................#......#......
..#..........##.......##..#.##.
.#.....#.......#...######..#..#
....##.#...#...#..........#....
.....#.......#...#.#.......###.
#...#.###.....#...#.......#....
.#.##.####....#.....#.#........
.......#.....##............##..
..#...#.#.##........#...##...#.
........#...####.##..#....#...#
#.......#...##.#......#..#...#.
......#.........#..###.#.#....#
#..##...#...#..#...#...#.....#.
.#...#...#.#.................##
#......#.....#..#.#..#......##.
.......#.##...#.......#.......#
.#.#..#..#......#....#.#...#.#.
..#...#.#..#......#...#.#.#....
........#..............#..##...
.##..#..##.#....#.#..###..#..#.
..#....#......#...#.#.#....#...
...#..#..#....#..#.....##......
.#......#...#........##........
.#......#..#...##..#..#.#.#....
.##......#.##.........#....#...
....#....##..#..###.#..#......#
....#....##..........#.#...#...
..##.#.............#..#.....#..
..#.....#....#....#.......##...
.##.#....#....#...#....##.#....
...#.#..#.###.#..#.#.......#.#.
.....##.....#.......#......#...
.#.....#..#.#.#..#........##...
##.....................#.......
..###............#........##..#
.#.##.....#..#..#..#.#.......#.
.##...................#..#..#..
..#.#...#..........##..#..##...
#......#..#..#.#..#......#..#.#
.#...#....#.#.........#.....#.#
#..........#.#....#....#.#.#.#.
#.....#..........#..#....#..#..
........#....#..##.#.#.......#.
.#.......##.......#..##...#....
...#..##..#......##.#..#.#..#..
.#..#.......#..##..#......#....
###.#.........#......#.#.......
...#......#....#..##..#.#..#...
......#..#.....#.........#....#
....#..#..#..#.........##.#..#.
......#..#..#..#....#...#..##.#
......##.#..#..#.#.......#.#.##
..#.....#...#..#....#..........
.##..##.....##.......#.##.#....
...#..#.......#..#.......#.....
.........#....##..#.#....#.#...
.....#..#...#.........#....#..#
.........##.....#.#...#.###...#
.#......####..##...#..#........
.#......##....#.....#..........
##.......##.#.......#..........
.#......#.#.#.#....#........#..
......##..##...#...#...........
.#...#.#..#......#.#.#.#....#.#
...#.........#.....#...###.....
#.....##....#.##...#....#......
.#..#...#..##.###.#.#.#...#....
...#......#..#....#...#...#....
.#..............#.....#........
..##...#.....#..#.....#..#.#...
.##...#....#.##...#.........##.
..#......#...##..#.....#......#
#.#..............#...#...#..#.#
..#..#.#...........#...#.#.#...
#..........#...#..#..##..#....#
............#...#........###...
.........#.....#.....#..#......
#...#.#..##......#.#####.......
...#........#..............#...
......###.#.#.....#..#....##.#.
.#.#.#..##....###.#..#....##...
.#....#.##............##.#.....
##...##.#......#.#.##.##...###.
.......#.#........#.....#......
....#.....#......#...#.#..#....
.#.........#....#...#...#...#.#
#.......#................#..#..
.##...........#.##...##....#...
#...#.#...###.........#.......#
.#...#.........................
#.......#...#.....##.##...##...
.#.#....#.......#.#.##.#....#..
#..#....#...#.#.##.#....#....#.
.##.....#.#..#...#..#..........
.............#...#.#..#........
....#........#..#......##......
#.....#....#.....#.......#.....
........#.......##....#........
.#.#..##.......................
##..#.....#........#.....#.....
.#......#.#...#.#..........#..#
.#..#.....#..#..........#.###..
......#.#..#.#.......#.#.....#.
.#....#......#..##.............
#...##.........#.#.#...#.....#.
..#................#..#..###...
#.....#....##.#..##......#.#.#.
..#....#...#...#...............
#................#....#...#.#..
................#...#.....#.##.
..#.#.#..#.##.......##.......##
...........#......##.......###.
...#.......##.........#.#.#.#..
.#...#.#..#...#.#.....#........
............#####......##......
....###....#.##...#..#.........
..#.#...#.......#...#...#.###..
..............##..#...#....#...
#.#..##...#....##.........#....
..#...#.....#...........#...#..
#.#..###..#.#..#........#..#.#.
...###...##...#...#.#.........#
..#........#.....#.#.#.......#.
...#..#..........#.....#...#...
....#..#.....#....##....#.##...
.....##..#...#.#..##...#...##.#
...........###...##....#.......
##..#.#..#..#...#....##..#..#..
##...#.#......##.#..#...#....#.
.#.......#...........#...#.....
#...#....#.......#...#.##......
.........#.......#...#.#...#...
.......##.#..................#.
........#..#.#......#.....#....
.....#.#.#.#....##...#.###.....
#.#.........#..#.#.#.#.#.......
.............#....#.......###..
.#.##....#....##.........####..
...........###.#...............
#.........##.#.#..#.....##.###.
.#.#.....#.#...#.....##...#...#
#....#...#.........#.#.......#.
.....#.###..#....#...##..#...#.
#........#....#.#..#....#.#....
#.#..##......#.........#.#.....
##..#.....#......###....#....#.
#.#.####..#.#.#......##...#..#.
....#.....#.#.#.#.....#........
..##..........#......#.#.#..#..
.#...##.##.........#.........##
..#.#.#..........#..#..#......#
###..###..#...#................
"

# COMMAND ----------

trees <-
  input %>%
  read_lines()

# COMMAND ----------

result <-
  trees %>%
  as_tibble() %>%
  mutate(
    i = 1 + (((seq_along(value) - 1) * 3) %% nchar(first(value))),
    result = str_sub(value, i, i),
    is_tree = result == '#'
  )
result

# COMMAND ----------

result %>% pull(is_tree) %>% sum()

# COMMAND ----------

# MAGIC %md ## Part 2

# COMMAND ----------

count_trees <- function(trees, n_right, n_down) {
  trees %>%
    as_tibble() %>%
    filter((row_number() - 1) %% n_down == 0) %>%
    mutate(
      i = 1 + (((seq_along(value) - 1) * n_right) %% nchar(first(value))),
      result = str_sub(value, i, i),
      is_tree = result == '#'
    ) %>%
    pull(is_tree) %>%
    sum(na.rm = TRUE)
}

# COMMAND ----------

count_trees(trees, 3, 1)

# COMMAND ----------

counts <- pmap(list(c(1, 3, 5, 7, 1), c(1, 1, 1, 1, 2)), count_trees, trees = trees)
counts

# COMMAND ----------

(unlist(counts) * 1) %>% reduce(`*`) # I'm not sure why I need *1. Actually - it is because the number exceeds the max integer?