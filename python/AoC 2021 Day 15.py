# Databricks notebook source
# MAGIC %md <article class="day-desc"><h2>--- Day 15: Chiton ---</h2><p>You've almost reached the exit of the cave, but the walls are getting closer together. Your submarine can barely still fit, though; the main problem is that the walls of the cave are covered in <a href="https://en.wikipedia.org/wiki/Chiton" target="_blank">chitons</a>, and it would be best not to bump any of them.</p>
# MAGIC <p>The cavern is large, but has a very low ceiling, restricting your motion to two dimensions. The shape of the cavern resembles a square; a quick scan of chiton density produces a map of <em>risk level</em> throughout the cave (your puzzle input). For example:</p>
# MAGIC <pre><code>1163751742
# MAGIC 1381373672
# MAGIC 2136511328
# MAGIC 3694931569
# MAGIC 7463417111
# MAGIC 1319128137
# MAGIC 1359912421
# MAGIC 3125421639
# MAGIC 1293138521
# MAGIC 2311944581
# MAGIC </code></pre>
# MAGIC <p>You start in the top left position, your destination is the bottom right position, and you <span title="Can't go diagonal until we can repair the caterpillar unit. Could be the liquid helium or the superconductors.">cannot move diagonally</span>. The number at each position is its <em>risk level</em>; to determine the total risk of an entire path, add up the risk levels of each position you <em>enter</em> (that is, don't count the risk level of your starting position unless you enter it; leaving it adds no risk to your total).</p>
# MAGIC <p>Your goal is to find a path with the <em>lowest total risk</em>. In this example, a path with the lowest total risk is highlighted here:</p>
# MAGIC <pre><code><em>1</em>163751742
# MAGIC <em>1</em>381373672
# MAGIC <em>2136511</em>328
# MAGIC 369493<em>15</em>69
# MAGIC 7463417<em>1</em>11
# MAGIC 1319128<em>13</em>7
# MAGIC 13599124<em>2</em>1
# MAGIC 31254216<em>3</em>9
# MAGIC 12931385<em>21</em>
# MAGIC 231194458<em>1</em>
# MAGIC </code></pre>
# MAGIC <p>The total risk of this path is <code><em>40</em></code> (the starting position is never entered, so its risk is not counted).</p>
# MAGIC <p><em>What is the lowest total risk of any path from the top left to the bottom right?</em></p>
# MAGIC </article>

# COMMAND ----------

inp = '''9288988799169797672494749255119669898996573999583986189239999598984799822348965745856766795499834649
9336897879889887886178547878932383343897969375528317888596414912984889899896681582897852799987698919
1897778869898975348195967299799218929299986987238888983439837668176288929486984281998883997689928399
9929379596989975588919354989848824879259338981764649316939699414591798996277899778297863349896687529
9299536973198975989668639599981992969988798261739729688719716614897359549861961677579672523167986511
7987961623297525864967191899298165876452579892878669981979557529983329311935283984796198899331498766
9933188395912993489929878928979164799949214314685899999949959978164816779811128692799288826655771954
9879411158118811985997999759791869896995299827179998882766687888891885997982991692167933582892854156
9998631525957988118287969721874572682352527971791899771898918585995689953667683999169491381879997972
9148272678595823589879662996981998894898844679741994169298499959867934999532187299167299186241998292
8967886285928969877498814378999894469497368728914983178727691699718399654813956289713487981828996297
2999393515291995229979897899399596921679288483969795189979696985897255988985689416376934128997218299
7817696897253996999651997969929981349899123948992659879897887667199775989882958778899293892998989276
9638635592568249933748715589514111329963291898199473693991698996362848147964599284195681914957329467
4958169729641951781983588759859969499895795879488199984497178298368899238979649719927899818641998489
9975869369989998759115433978632495978793749977511549989984223394977735997142889411977899995898137993
9459965977995489288474399895689998695961956993692699421769614323193479393955974793991182999979389958
8994981918488815875941366194919798679996477924993929237972119998926286352895291999868513555622933869
9978788955499954429538318136599937492729898626382799896379749839156697643991476929999443913972759281
9789326441993961917529769129211514818927459529999665126819834992573899989577699452197919499789111899
5645266999796592329963869997412285981628471859718122319982899417968932949924886989359739949384198886
4151433899456957966682999728989743799492988668799291189825989779923276699886797988429994794438971668
7192698711984233938996888119995889991972929159599994289919539966249787249972571194978959978992687611
2188999661989826988581693997894588683797868679171937998388999529486952918189269993969428519963791967
9861892485895498492212599425976855994975985912626678899459997129997798893717498885748998996987987997
6362488549459179788479968499975364362547921271989899979997419937987319622952986237496986284699314297
5497988785661358759985368549985499987879978818164923953194687168865459988799882727999431919418957792
8921689612499495196716939839129969948877994484939159896618549595749671852996979999898289792879849397
9117892818987897191767559599815947974867469568839917771471898394159117985171699936812298616598548579
9499687172935737495154289999572674963694459699667979694997258367529924396919185817635144899393296999
9359917393876189496794996228496429878984488199998998519969886192894999822998691883882855832938745789
5991899864977697724629999715775227413957489939767875967492379866938689479737899737238139929793229691
8773773941114912996998195388691327897589927937565864699875956954763217688963799581693978929456769918
3789413727298922758699481168799996951192669889822813961131496997515599269239941498598558992664989219
6593995867928869718437459956978746861975998936541855894996991791844649276462868699996942599192789759
1993341135872935287172387257312453769899771419861468869997994169176169949614122255777814279818269918
2969135998691189572857989199653891178966992543799975499874487811962496191967999489743499839598884687
9787789572211797194337999256191563897691817781945298867986284396979988791729938633187393569589869918
2299959163318689978729376684584292391777894958897598287996132978169997894991998998599977549738278923
3691949798949888798168941149915567331911818129929718518938167387689939299824771197638987817379892989
9749785619856999652449487875688981561193591826594362649994939666967979778512799696341955711919984978
9881927664728581359934177289639895786194274231975664274195899997999687929598893691365837899273425129
9919419886679822926611867726862553187195651759289168197679985899689947964717915885111276899888197966
9231598837249477616689995515695824792669591942461898459897688991749911988958996929699359978565275725
2892658244889159188897479599898949898749977971288388998787787997948558944985976998979898962172685897
9979588759684339829796553677828895958589919229599989589392589747761568985977998861579949161187997233
6287215915683729958932894699999247639399978989597899848299991995847221899992518166862818775179559971
2799894917998999998874784789594789858417957771571473748859999329599135947687373576896989993589961874
5921848262785779887771299979768834439798859747883569786946978457756498658975779671982998713657998999
9997786782929186285839956198479977866697199917635186717999819821816856594838498858245992265954264934
9954997215627599265929978387691134766992481123697456499693917895998289479717119612991968988158439691
9916272332984989918199969936999599699155379896778714667674586619938853681649448451872845859999239829
1256399471117548567985989955892899689887699697686297558119846998699918385686487875399995279928741588
7177168446299683823212949816929791389289577545289534897191769788823948882469977935993994579671821187
6979892421886929946739955799883719139893871273491387787287522865999759437718571283535249569138967648
4145997935994642989996771886889569927531998999268917912388818819496782276477165999995719866649747764
8898899748735667899752999477989593963868993879144929617748885292969974337666618879885768988931287698
9196988991448764896467189989479747838137156849499359959399476958168494834619648549898691614999879739
7925876418947885867316298842933587498796372993949569174199698294898468184868798782855986566997769253
5999995536941691894699798926989158981998299942565537791869569799989677238748115794415979948626971297
8896561829785751826769983485679999991699195576827934937515391627992938198466316849988998981931463975
1678992985845917991999559999398498659179639589116974399879277638914599511895856993791955948698936769
8723555973519986597726497991769996916871959668366828894199899193915299198488937535299891992439299937
9859879779999559469859989149991235571476226458448738485449684831869569129983688918615773979995919197
1762274915495299837161988958831218291579987895596819387889529513259546684889197517888399895193724779
2329987489878172595959982221592989791917892847896794565689456987698924854979316862189958639879898937
7711657684176742515913464892986549152966165389597999969269518687598991498112999894982942789276718458
9989179928937989827799268436844255995598521878597942899959459198973751659286887993912795839916999399
4567145965886799947748995493953341996258925919999689739976496999948828257798971787719678969851996746
8553979659889688912787934849749991288998219549994188353936124999195218388671689915579964878413489665
2458758981536446277157958999192653841815897922998795986691787998661699134582798739519913786926595735
9233467899499484399916213919898118589935927969443759859978699389889676999696349897998592979919998299
1621957847935871765819681398937934599688352958522142283796985527189865829779968678199997198567691768
9673864188986737727887346587481936992239789665514689835781751549838861996989972756948968698623688959
7897146188799288444495998299966977488868899799997994924917119827858775911816351681497482299111997691
2568718799789199779398689847783149889479969577949265239141878557193889688765334449955197999914987965
6939937695943799169928279532995937199758313658599658967819433777451979789913959439926566929189199369
5999854888947964889779299422517269958222959149218639862111399697889988998988495479874922759149779792
8898165192853343774932725119999895929144898798828668998787399878577998661677495889352267795135479958
9578193578475986498984689899679398178897882619949696877398898259198963869894573999782235189917995779
9614779614699666248931887454849181959988389121797844916823925964183788999781794279997178499292189339
7154633697899892718176319474169673818225779991699839667193959375999134917851861694489619849782799983
7616913966129714997489291681867995117771128927779449285994725191838843376673798698999374745869928979
9818776583846956356779687821191959633714565781299649977899949519971939492224983479969178589787741359
8699924979993138798977989952516599159628999129974189852977567885894191476728992769469629699859245899
9913371369899982359888716676984987479626245958159698436779975279878971677837387679871384371297934939
8599771948779192996924339399766946995298899149959179412988741928283199591227819893228869673194965697
8489944889371697897296993939299713849254969988799792753882795824818789664812129936966999988791751921
6976789988678861958199499445892799332971227632999989936177688529771589699899882978971429758899779998
5968497692829128995138725999979828117911719698428448259968286871278658929934846599584982263818912698
8958452959267676424741399686862372997728797445179742993896977988979989612483887199299999714618977759
4999382992857889814779859518559958458978116999689569869899929626199925858874989715889286699966189192
6821852498859387994787881789359711946699741427195989164226682888818389599911297889796498646148759263
9985999614831878291177496865999896852915236956397629682728379999748678194954611317891917837599992421
1898728946843198193289979889889991686685685399948883227849222754865945897392179762979369894261974859
8239479653435399988579899419849928235496516187895769626582993984392699899597869988769889562986328589
2749999498518999696779743457991992199779379529978126229362411788511691877869319879963998164177714684
5499969865189779991198556392918514799593899919672411987351966179399942999818128941959596331883477879
4719866799939881495699681785999974276299998443822677143998839821795639964258984499989679929197977689
6994796719999998996693827884457853594797687747694968116959893999957898943799975585881539179956768118'''

# COMMAND ----------

import heapq


def smallest_risk_path(risk_levels):
  target = max(risk_levels)
  states = [(0, 0, 0)]
  visited = set()

  while states:
    risk, row, col = heapq.heappop(states)

    if (row, col) in visited:
      continue
    visited.add((row, col))
    
    if (row, col) == target:
      return risk

    for direction in ['N', 'S', 'E', 'W']:
      new_row = row + (direction == 'S') -  (direction == 'N')
      new_col = col + (direction == 'E') -  (direction == 'W')

      if (new_row, new_col) not in risk_levels:
        continue

      heapq.heappush(states, (risk + risk_levels[(new_row, new_col)], new_row, new_col))

      
risk_levels = {(row, col): int(risk_level) for row, line in enumerate(inp.splitlines()) for col, risk_level in enumerate(line)}

answer = smallest_risk_path(risk_levels)
print(answer)

# COMMAND ----------

# MAGIC %md <article class="day-desc"><h2 id="part2">--- Part Two ---</h2><p>Now that you know how to find low-risk paths in the cave, you can try to find your way out.</p>
# MAGIC <p>The entire cave is actually <em>five times larger in both dimensions</em> than you thought; the area you originally scanned is just one tile in a 5x5 tile area that forms the full map. Your original map tile repeats to the right and downward; each time the tile repeats to the right or downward, all of its risk levels <em>are 1 higher</em> than the tile immediately up or left of it. However, risk levels above <code>9</code> wrap back around to <code>1</code>. So, if your original map had some position with a risk level of <code>8</code>, then that same position on each of the 25 total tiles would be as follows:</p>
# MAGIC <pre><code>8 9 1 2 3
# MAGIC 9 1 2 3 4
# MAGIC 1 2 3 4 5
# MAGIC 2 3 4 5 6
# MAGIC 3 4 5 6 7
# MAGIC </code></pre>
# MAGIC <p>Each single digit above corresponds to the example position with a value of <code>8</code> on the top-left tile. Because the full map is actually five times larger in both dimensions, that position appears a total of 25 times, once in each duplicated tile, with the values shown above.</p>
# MAGIC <p>Here is the full five-times-as-large version of the first example above, with the original map in the top left corner highlighted:</p>
# MAGIC <pre><code><em>1163751742</em>2274862853338597396444961841755517295286
# MAGIC <em>1381373672</em>2492484783351359589446246169155735727126
# MAGIC <em>2136511328</em>3247622439435873354154698446526571955763
# MAGIC <em>3694931569</em>4715142671582625378269373648937148475914
# MAGIC <em>7463417111</em>8574528222968563933317967414442817852555
# MAGIC <em>1319128137</em>2421239248353234135946434524615754563572
# MAGIC <em>1359912421</em>2461123532357223464346833457545794456865
# MAGIC <em>3125421639</em>4236532741534764385264587549637569865174
# MAGIC <em>1293138521</em>2314249632342535174345364628545647573965
# MAGIC <em>2311944581</em>3422155692453326671356443778246755488935
# MAGIC 22748628533385973964449618417555172952866628316397
# MAGIC 24924847833513595894462461691557357271266846838237
# MAGIC 32476224394358733541546984465265719557637682166874
# MAGIC 47151426715826253782693736489371484759148259586125
# MAGIC 85745282229685639333179674144428178525553928963666
# MAGIC 24212392483532341359464345246157545635726865674683
# MAGIC 24611235323572234643468334575457944568656815567976
# MAGIC 42365327415347643852645875496375698651748671976285
# MAGIC 23142496323425351743453646285456475739656758684176
# MAGIC 34221556924533266713564437782467554889357866599146
# MAGIC 33859739644496184175551729528666283163977739427418
# MAGIC 35135958944624616915573572712668468382377957949348
# MAGIC 43587335415469844652657195576376821668748793277985
# MAGIC 58262537826937364893714847591482595861259361697236
# MAGIC 96856393331796741444281785255539289636664139174777
# MAGIC 35323413594643452461575456357268656746837976785794
# MAGIC 35722346434683345754579445686568155679767926678187
# MAGIC 53476438526458754963756986517486719762859782187396
# MAGIC 34253517434536462854564757396567586841767869795287
# MAGIC 45332667135644377824675548893578665991468977611257
# MAGIC 44961841755517295286662831639777394274188841538529
# MAGIC 46246169155735727126684683823779579493488168151459
# MAGIC 54698446526571955763768216687487932779859814388196
# MAGIC 69373648937148475914825958612593616972361472718347
# MAGIC 17967414442817852555392896366641391747775241285888
# MAGIC 46434524615754563572686567468379767857948187896815
# MAGIC 46833457545794456865681556797679266781878137789298
# MAGIC 64587549637569865174867197628597821873961893298417
# MAGIC 45364628545647573965675868417678697952878971816398
# MAGIC 56443778246755488935786659914689776112579188722368
# MAGIC 55172952866628316397773942741888415385299952649631
# MAGIC 57357271266846838237795794934881681514599279262561
# MAGIC 65719557637682166874879327798598143881961925499217
# MAGIC 71484759148259586125936169723614727183472583829458
# MAGIC 28178525553928963666413917477752412858886352396999
# MAGIC 57545635726865674683797678579481878968159298917926
# MAGIC 57944568656815567976792667818781377892989248891319
# MAGIC 75698651748671976285978218739618932984172914319528
# MAGIC 56475739656758684176786979528789718163989182927419
# MAGIC 67554889357866599146897761125791887223681299833479
# MAGIC </code></pre>
# MAGIC <p>Equipped with the full map, you can now find a path from the top left corner to the bottom right corner with the lowest total risk:</p>
# MAGIC <pre><code><em>1</em>1637517422274862853338597396444961841755517295286
# MAGIC <em>1</em>3813736722492484783351359589446246169155735727126
# MAGIC <em>2</em>1365113283247622439435873354154698446526571955763
# MAGIC <em>3</em>6949315694715142671582625378269373648937148475914
# MAGIC <em>7</em>4634171118574528222968563933317967414442817852555
# MAGIC <em>1</em>3191281372421239248353234135946434524615754563572
# MAGIC <em>1</em>3599124212461123532357223464346833457545794456865
# MAGIC <em>3</em>1254216394236532741534764385264587549637569865174
# MAGIC <em>1</em>2931385212314249632342535174345364628545647573965
# MAGIC <em>2</em>3119445813422155692453326671356443778246755488935
# MAGIC <em>2</em>2748628533385973964449618417555172952866628316397
# MAGIC <em>2</em>4924847833513595894462461691557357271266846838237
# MAGIC <em>324</em>76224394358733541546984465265719557637682166874
# MAGIC 47<em>15</em>1426715826253782693736489371484759148259586125
# MAGIC 857<em>4</em>5282229685639333179674144428178525553928963666
# MAGIC 242<em>1</em>2392483532341359464345246157545635726865674683
# MAGIC 246<em>1123532</em>3572234643468334575457944568656815567976
# MAGIC 423653274<em>1</em>5347643852645875496375698651748671976285
# MAGIC 231424963<em>2342</em>5351743453646285456475739656758684176
# MAGIC 342215569245<em>332</em>66713564437782467554889357866599146
# MAGIC 33859739644496<em>1</em>84175551729528666283163977739427418
# MAGIC 35135958944624<em>61</em>6915573572712668468382377957949348
# MAGIC 435873354154698<em>44</em>652657195576376821668748793277985
# MAGIC 5826253782693736<em>4</em>893714847591482595861259361697236
# MAGIC 9685639333179674<em>1</em>444281785255539289636664139174777
# MAGIC 3532341359464345<em>2461</em>575456357268656746837976785794
# MAGIC 3572234643468334575<em>4</em>579445686568155679767926678187
# MAGIC 5347643852645875496<em>3</em>756986517486719762859782187396
# MAGIC 3425351743453646285<em>4564</em>757396567586841767869795287
# MAGIC 4533266713564437782467<em>554</em>8893578665991468977611257
# MAGIC 449618417555172952866628<em>3163</em>9777394274188841538529
# MAGIC 462461691557357271266846838<em>2</em>3779579493488168151459
# MAGIC 546984465265719557637682166<em>8</em>7487932779859814388196
# MAGIC 693736489371484759148259586<em>125</em>93616972361472718347
# MAGIC 17967414442817852555392896366<em>6413</em>91747775241285888
# MAGIC 46434524615754563572686567468379<em>7</em>67857948187896815
# MAGIC 46833457545794456865681556797679<em>26</em>6781878137789298
# MAGIC 645875496375698651748671976285978<em>21</em>873961893298417
# MAGIC 4536462854564757396567586841767869<em>7</em>952878971816398
# MAGIC 5644377824675548893578665991468977<em>6112</em>579188722368
# MAGIC 5517295286662831639777394274188841538<em>5</em>299952649631
# MAGIC 5735727126684683823779579493488168151<em>4</em>599279262561
# MAGIC 6571955763768216687487932779859814388<em>1</em>961925499217
# MAGIC 7148475914825958612593616972361472718<em>34725</em>83829458
# MAGIC 28178525553928963666413917477752412858886<em>3</em>52396999
# MAGIC 57545635726865674683797678579481878968159<em>2</em>98917926
# MAGIC 57944568656815567976792667818781377892989<em>24</em>8891319
# MAGIC 756986517486719762859782187396189329841729<em>1431</em>9528
# MAGIC 564757396567586841767869795287897181639891829<em>2</em>7419
# MAGIC 675548893578665991468977611257918872236812998<em>33479</em>
# MAGIC </code></pre>
# MAGIC <p>The total risk of this path is <code><em>315</em></code> (the starting position is still never entered, so its risk is not counted).</p>
# MAGIC <p>Using the full map, <em>what is the lowest total risk of any path from the top left to the bottom right?</em></p>
# MAGIC </article>

# COMMAND ----------

max_row, max_col = (pos + 1 for pos in max(risk_levels))
risk_levels_extended = {}

for (row, col), risk in risk_levels.items():
  for tile_row in range(5):
    for tile_col in range(5):
      new_risk = risk + tile_row + tile_col
      new_risk = new_risk % 10 + new_risk // 10
      risk_levels_extended[row + max_row * tile_row, col + max_col * tile_col] = new_risk

answer = smallest_risk_path(risk_levels_extended)
print(answer)
