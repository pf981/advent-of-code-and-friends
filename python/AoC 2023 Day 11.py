# Databricks notebook source
# %pip install z3-solver

# COMMAND ----------

inp = '''...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....
'''

# COMMAND ----------

inp = '''.......................................#..........................................................#......................................#..
.....................#................................#.....................................................................................
....#.....#...................#...............#....................#.....................#.....................#....................#.......
............................................................................................................................................
.................#......................................................#......#..............#....................#........................
......................................#.....................................................................................................
.......................................................#...................................................#..............#.................
.............................................................#..........................#...................................................
............#..............................#.................................#.................................................#............
#.................................#.............#................#....................................................................#.....
....................................................................................#................#......................................
....#..........#............#...........................................#..................#..................#...................#.........
......................................#...................#.................................................................#.............#.
........#....................................#.......#......................................................................................
........................................................................................#..........#........................................
..#................................................................#........................................................................
..............................#...............................................#.....................................#............#..........
...................#........................................................................................................................
...........#......................#........#................................................................................................
...............................................................#.................#.........................#................................
......................................................#.....................................#...............................................
........#............................................................................#................................#.........#...........
................#...........#...............................................................................................................
.....................#........................#........................#.....................................#............................#.
....#........................................................#................#.............................................#...............
............................................................................................................................................
.....................................................................................................#.............#...................#....
..........................#...........#.........................................................................................#...........
#......................................................#.........................................#............#........#....................
.........#.....................................#....................................#.......................................................
.................................#..................................#......................................................#........#.......
.........................................................................................................#..................................
......#.............#....................................................#..................................................................
..........................#........................................................................................#........................
.#.......................................#...................#...............#........................#..................#..................
..................................#..............#...........................................................#.................#............
.........#.........................................................#........................#...............................................
....................................................................................#.......................................................
.....#........#............................#...............................#.........................................#......................
......................................................................#..................................#..................................
............................#..................#........#..............................................................................#....
.......................#.............#......................................................................................................
#..........#...................................................#.......................#........................#......#....................
....................................................#.............................................#.........................................
.................................................................................................................................#..........
..................................#....................................................................#....................................
........#.......................................#............#.....#........#...............................................................
............................................................................................................................................
............................................................................................................................................
..........................#.............................................................#.........................#.........................
..#............................#..........#..................................................................................#..............
..................#...................................................#.............#.......................#.............................#.
............#.................................#........#.....#..............................................................................
............................................................................................................................................
.......................................................................................#..............#.................#...........#.......
....................#.....#....................................................#............#.................#.............................
....#............................................................................................#..............................#..........#
............................................................................................................................................
...............................#......................#...............................................................#.....................
.................................................#...............#..................#.........#.............................#...............
........#......#.....................#................................................................................................#.....
.............................................#.................................#............................................................
.#......................#..............................................................#................#...................................
............#.....#.....................................................................................................#...................
..................................#.....................................................................................................#...
............................................................................................................................................
......#...............................................................#........................#..............................#.............
.....................#...........................#....................................#..............................#......................
............................................................................#...............................................................
............#................#........#.......................#.....................................#.......................................
............................................................................................#.................#...........#.................
...................#................................................................................................................#.......
...................................#...................#..........#............#............................................................
#.........................................#.....#..................................................................#........................
............................................................................................................#....................#..........
..........#..........................................................#.................................#...................................#
............................................................................................................................................
......#.................#.......................................................#...............#.........................#.................
.............................#................#...................#.............................................#...........................
.............#.......................................#......................#.......#................................#......................
........................................#................................................#...........................................#......
...................................#........................................................................................................
.................#...........................................#..............................................................#...............
.........#................#.......................................................................................#.........................
.....................#......................................................................................................................
.#..............................................................#............#..........#.....#.........#...................................
......#.................................#.............................#.....................................................................
................................................................................................................................#...........
......................................................#............................................#....................#..............#....
.........................#...................#..............................................................................................
...............................................................#............#..........#.................#..................................
..................................#.........................................................................................................
...............#..........................................................................................................#......#..........
............................................................................................................................................
......#........................................#..................................#................#..................................#.....
.#..........................#.........#.............................................................................#.......................
.......................................................#......................#.......#.....................................................
.............................................................#.................................................................#............
...............#......................................................................................#.......#...........................#.
.....#....................................................................#...................#.............................................
..........................#................#.....#................#.........................................................................
..................................................................................#.................................#......#...........#....
.................#..........................................................................................................................
..................................#.........................................................................................................
...........#.........................................#.................#...............#....................................................
................................................................#..............................#..........#....................#............
...............#.............#............................#..................#..............................................................
..#............................................#...........................................................................#................
......................#.....................................................................................................................
.......................................#.................................#..........................................................#.......
...................................................................#........................................................................
....#.............#................................................................#..................................#......#..............
.............................................................#..............................................................................
.........#................#.....................#.....................#.....#.....................#.......#.................................
...................................................................................................................................#........
...........................................#...............................................#................................................
.....................................................#..........#....................#...........................#............#.........#...
.#.............#......#.....................................................................................................................
.............................#............................................#..............................#..................................
.......................................#............................................................................#.......................
..................#......................................#............#.............................#.......................................
.........#................#.....................................................#..............#.............#....................#.......#.
..#..............................................................#.........................................................#................
...................................#..........#.............................#.........................................................#.....
......#..............................................................................................................#......................
..............#.............................................................................................................................
......................................................#........#.................#.......................................#..................
......................#.......#.................#......................................#.......#...............#............................
..#..............#.......................#..................................................................................................
.......................................................................#...................#.............#..................................
.........#..........................................................................#.................................#.....................
......................................#..................#.......................................#....................................#.....
.........................#............................................................................#.......#.............#...............
....................#.........................................#.............................................................................
...............#............................................................................................................................
......................................................................#...........#........#...................................#............
.................................#..........#...............................................................................................
......#..........................................#............................#....................................#........................
...............................................................#...........................................#.............................#..
..#.........#..........#.................#..........................................................#.......................................
'''

# COMMAND ----------

g = inp.splitlines()
empty_rows = [i for i, row in enumerate(g) if '#' not in row]
empty_cols = [i for i, row in enumerate(zip(*g)) if '#' not in row]
empty_rows, empty_cols

# COMMAND ----------


g = inp.splitlines()
empty_rows = [i for i, row in enumerate(g) if '#' not in row]
empty_cols = [i for i, row in enumerate(zip(*g)) if '#' not in row]
empty_rows, empty_cols

import collections
galaxies = [(row, col) for row, line in enumerate(g) for col, c in enumerate(line) if c == '#']
pairs = [(galaxies[i], galaxies[i2]) for i in range(len(galaxies)) for i2 in range(i+1, len(galaxies))]
# print(len(pairs))


def get_shortest_distance(g1, g2):
    q = collections.deque([(g1, 0)])
    seen = set()
    while q:
        pos, d = q.popleft()
        if pos == g2:
            return d
        if pos in seen:
            continue
        seen.add(pos)

        d += 1 + ((pos[0] in empty_rows) or (pos[1] in empty_cols))
        q.append(((pos[0] - 1, pos[1]), d))
        q.append(((pos[0] + 1, pos[1]), d))
        q.append(((pos[0], pos[1] - 1), d))
        q.append(((pos[0], pos[1] + 1), d))


# answer = 0
# for g1, g2 in pairs:
#     answer += get_shortest_distance(g1, g2)
# print(answer)

z=1_000_000-1
answer=0
for g1, g2 in pairs:
    d_row = abs(g2[0] - g1[0])
    for row in empty_rows:
        if min(g1[0], g2[0]) < row < max(g1[0], g2[0]):
            #d_row += 1_000_000
            d_row += z

    d_col = abs(g2[1] - g1[1])
    for col in empty_cols:
        if min(g1[1], g2[1]) < col < max(g1[1], g2[1]):
            # d_col += 1_000_000
            d_col += z
    answer += d_row + d_col
print(answer)

# 726820896326 not right

# COMMAND ----------

# import collections
# galaxies = [(row, col) for row, line in enumerate(g) for col, c in enumerate(line) if c == '#']
# pairs = [(galaxies[i], galaxies[i2]) for i in range(len(galaxies)) for i2 in range(i+1, len(galaxies))]

# def get_shortest_distance(g1, g2):
#     q = collections.deque([(g1, 0)])
#     seen = set()
#     while q:
#         pos, d = q.popleft()
#         if pos == g2:
#             return d
#         if pos in seen:
#             continue
#         seen.add(pos)
        
#         d += 1 + ((pos[0] in empty_rows) or (pos[1] in empty_cols))
#         q.append(((pos[0] - 1, pos[1]), d))
#         q.append(((pos[0] + 1, pos[1]), d))
#         q.append(((pos[0], pos[1] - 1), d))
#         q.append(((pos[0], pos[1] + 1), d))


# answer = 0
# for g1, g2 in pairs:
#     answer += get_shortest_distance(g1, g2)
# print(answer)

# COMMAND ----------

# 93096 pairs

# COMMAND ----------

galaxies
